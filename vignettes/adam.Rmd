---
title: "adam"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{adam}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(baconr)
library(tidyverse)

set.seed(20200827)
```


A quick example using the example data from the rbacon package.


## Calibrate the radiocarbon ages to calendar ages.

```{r}
# function calibrate_14C_age will append columns to a data.frame with the 
# calendar ages and 1 sigma uncertainties
MSB2K_cal <- calibrate_14C_age(MSB2K, age.14C = "age", age.14C.se = "error")
```

#### Assign to 3 cores, one per chain, as long as the machine has at least 3

```{r}
if (parallel::detectCores() >= 3) options(mc.cores = 3)
```

```{r}
adam_fit_1 <- adam(depth = MSB2K_cal$depth,
                   obs_age = MSB2K_cal$age.14C.cal,
                   obs_err = MSB2K_cal$age.14C.cal.se,
                   K = c(10, 10))
```


### Default plot

```{r}
plot_adam(adam_fit_1)
```

### Plot "spaghetti" instead of shaded regions

```{r}
plot_adam(adam_fit_1, type = "spag")
```

### Prior and posterior of overall mean accumulation rate

```{r}
plot_acc_mean_prior_posterior(adam_fit_1)
```

### Plot modelled accumulation rates at each hierarchical level

```{r}
plot_hierarchical_acc_rate(adam_fit_1)
```


### Plot memory prior and posterior

As for this example the highest resolution sections are approximately 1 cm thick, there is not much difference between R and w. 

```{r}
plot_memory_prior_posterior(adam_fit_1)
```


### Examine calendar age PDFs

Unlike Bacon, HAMStR approximates the complicated empirical calendar age PDFs with t-distributions. These can be examined with the function `compare_14C_PDF`

The six dates are plotted here.

```{r}
i <- seq(1, 40, by = floor(40/6))[1:6]
compare_14C_PDF(MSB2K$age[i], MSB2K$error[i])
```


## Refit with fewer sections at the highest resolution


```{r}
adam_fit_2 <- adam(depth = MSB2K_cal$depth,
                   obs_age = MSB2K_cal$age.14C.cal,
                   obs_err = MSB2K_cal$age.14C.cal.se,
                   K = c(4, 5))
```

```{r}
plot_adam(adam_fit_2)
```

```{r}

```


## Refit with 21 non-hierarchical sections

```{r}
adam_fit_3 <- adam(depth = MSB2K_cal$depth,
                   obs_age = MSB2K_cal$age.14C.cal,
                   obs_err = MSB2K_cal$age.14C.cal.se,
                   K = c(21))
```

```{r}
plot_adam(adam_fit_3)
```

```{r}
plot_adam(adam_fit_3, type = "spag")
```



## Refit with maximum hierarchical structure

```{r}
adam_fit_4 <- adam(depth = MSB2K_cal$depth,
                   obs_age = MSB2K_cal$age.14C.cal,
                   obs_err = MSB2K_cal$age.14C.cal.se,
                   K = c(10, 10),
                   mem_mean = 0.5, mem_strength = 2,
                   scale_R = FALSE)
```

```{r}
plot_adam(adam_fit_4)

plot_acc_mean_prior_posterior(adam_fit_4)
```

```{r}
plot_adam(adam_fit_4, type = "spag")
```


